<!DOCTYPE html>
<html>
<head>
    <title>Test Minified Pie Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-line;
        }
        .chart-container {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            min-height: 450px;
        }
    </style>
</head>
<body>
    <h1>Minified Pie Chart Test</h1>
    
    <div class="debug-info" id="debug-info">Loading dependencies...</div>

    <div class="test-container">
        <h2>Test 1: Standard Pie Chart</h2>
        <div id="chart-1" class="chart-container"></div>
    </div>

    <div class="test-container">
        <h2>Test 2: Donut Chart (Inner Radius)</h2>
        <div id="chart-2" class="chart-container"></div>
    </div>

    <div class="test-container">
        <h2>Test 3: Large Dataset (8 Slices)</h2>
        <div id="chart-3" class="chart-container"></div>
    </div>

    <div class="test-container">
        <h2>Test 4: No Labels + Legend</h2>
        <div id="chart-4" class="chart-container"></div>
    </div>

    <!-- Load React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script>
        let debugLog = '';
        
        function log(message) {
            debugLog += message + '\n';
            document.getElementById('debug-info').textContent = debugLog;
            console.log(message);
        }

        // Initial dependency check
        log('üîç Checking dependencies...');
        log('React version: ' + (React ? React.version : 'NOT LOADED'));
        log('ReactDOM available: ' + (!!ReactDOM));
        log('ReactDOM.createRoot available: ' + !!(ReactDOM && ReactDOM.createRoot));
        log('');
    </script>
    
    <!-- Load your actual minified pie chart library -->
    <script src="./dist/pie-payments-charts.min.js"></script>
    
    <script>
        // Wait a moment for the script to load, then test
        setTimeout(function() {
            log('üì¶ Checking PaymentsCharts after load...');
            log('window.PaymentsCharts type: ' + typeof window.PaymentsCharts);
            
            if (window.PaymentsCharts) {
                log('PaymentsCharts object keys: ' + Object.keys(window.PaymentsCharts).join(', '));
                log('PaymentsCharts.render type: ' + typeof window.PaymentsCharts.render);
                log('PaymentsCharts.renderPieChart type: ' + typeof window.PaymentsCharts.renderPieChart);
            } else {
                log('‚ùå window.PaymentsCharts is not available');
            }
            log('');
            
            // Test the charts
            runChartTests();
        }, 500);

        function runChartTests() {
            log('üöÄ Starting pie chart tests...');
            
            // Test data - Payment Methods Distribution
            const paymentMethodsData = [
                { name: "Card payments", volume: 145000 },
                { name: "Bank transfers", volume: 89000 },
                { name: "Digital wallets", volume: 67000 },
                { name: "Direct debit", volume: 34000 },
                { name: "Cash", volume: 12000 },
                { name: "Cheques", volume: 3000 }
            ];

            // Test data - Sector Values
            const sectorValueData = [
                { name: "Retail", value: 2500000 },
                { name: "E-commerce", value: 1800000 },
                { name: "Financial services", value: 1200000 },
                { name: "Healthcare", value: 850000 },
                { name: "Government", value: 600000 }
            ];

            // Test data - Regional Distribution (8 slices)
            const regionalData = [
                { name: "London", volume: 450000 },
                { name: "South East", volume: 320000 },
                { name: "North West", volume: 280000 },
                { name: "Midlands", volume: 240000 },
                { name: "Scotland", volume: 180000 },
                { name: "Wales", volume: 120000 },
                { name: "North East", volume: 95000 },
                { name: "South West", volume: 185000 }
            ];

            // Test data - Simple 4 slice
            const customerSegmentData = [
                { name: "Enterprise", revenue: 3200000 },
                { name: "SME", revenue: 1800000 },
                { name: "Startups", revenue: 950000 },
                { name: "Non-profit", revenue: 450000 }
            ];

            // Test 1: Standard pie chart
            log('ü•ß Testing standard pie chart...');
            try {
                if (window.PaymentsCharts && window.PaymentsCharts.renderPieChart) {
                    window.PaymentsCharts.renderPieChart('chart-1', {
                        data: paymentMethodsData,
                        title: 'Payment Methods Distribution',
                        height: 400,
                        sourceText: 'UK Finance payment statistics',
                        showInnerRadius: false,
                        showLabels: true,
                        showLegend: true
                    });
                    log('‚úÖ Standard pie chart render called successfully');
                } else if (window.PaymentsCharts && window.PaymentsCharts.render) {
                    // Fallback to generic render method
                    window.PaymentsCharts.render('chart-1', {
                        data: paymentMethodsData,
                        title: 'Payment Methods Distribution (fallback)',
                        height: 400,
                        sourceText: 'UK Finance payment statistics'
                    });
                    log('‚úÖ Standard pie chart render called successfully (fallback)');
                } else {
                    log('‚ùå PaymentsCharts.renderPieChart not available');
                    document.getElementById('chart-1').innerHTML = '<p style="color: red;">PaymentsCharts.renderPieChart not available</p>';
                }
            } catch (error) {
                log('üí• Standard pie chart error: ' + error.message);
                document.getElementById('chart-1').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }

            // Test 2: Donut chart (inner radius)
            setTimeout(() => {
                log('üç© Testing donut chart (inner radius)...');
                try {
                    if (window.PaymentsCharts && window.PaymentsCharts.renderPieChart) {
                        window.PaymentsCharts.renderPieChart('chart-2', {
                            data: sectorValueData,
                            title: 'Transaction Values by Sector',
                            height: 400,
                            sourceText: 'Industry sector analysis',
                            showInnerRadius: true, // This creates the donut effect
                            showLabels: true,
                            showLegend: false
                        });
                        log('‚úÖ Donut chart render called successfully');
                    } else {
                        log('‚ùå PaymentsCharts.renderPieChart not available for donut chart');
                        document.getElementById('chart-2').innerHTML = '<p style="color: red;">PaymentsCharts.renderPieChart not available</p>';
                    }
                } catch (error) {
                    log('üí• Donut chart error: ' + error.message);
                    document.getElementById('chart-2').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
                }
            }, 1000);

            // Test 3: Large dataset (8 slices)
            setTimeout(() => {
                log('ü•ß Testing large dataset (8 slices)...');
                try {
                    if (window.PaymentsCharts && window.PaymentsCharts.renderPieChart) {
                        window.PaymentsCharts.renderPieChart('chart-3', {
                            data: regionalData,
                            title: 'Regional Payment Distribution',
                            height: 400,
                            sourceText: 'UK regional payment data',
                            showInnerRadius: false,
                            showLabels: true,
                            showLegend: false,
                            notesDescription: 'This chart shows payment distribution across UK regions. Some smaller slices may not show labels if they represent less than 3% of the total.'
                        });
                        log('‚úÖ Large dataset chart render called successfully');
                    } else {
                        log('‚ùå PaymentsCharts.renderPieChart not available for large dataset');
                        document.getElementById('chart-3').innerHTML = '<p style="color: red;">PaymentsCharts.renderPieChart not available</p>';
                    }
                } catch (error) {
                    log('üí• Large dataset chart error: ' + error.message);
                    document.getElementById('chart-3').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
                }
            }, 2000);

            // Test 4: No labels + legend
            setTimeout(() => {
                log('üìä Testing chart with legend instead of labels...');
                try {
                    if (window.PaymentsCharts && window.PaymentsCharts.renderPieChart) {
                        window.PaymentsCharts.renderPieChart('chart-4', {
                            data: customerSegmentData,
                            title: 'Customer Segments by Revenue',
                            height: 400,
                            sourceText: 'Customer segmentation analysis',
                            showInnerRadius: true,
                            showLabels: false, // Hide labels
                            showLegend: true   // Show legend instead
                        });
                        log('‚úÖ Legend-based chart render called successfully');
                    } else {
                        log('‚ùå PaymentsCharts.renderPieChart not available for legend chart');
                        document.getElementById('chart-4').innerHTML = '<p style="color: red;">PaymentsCharts.renderPieChart not available</p>';
                    }
                } catch (error) {
                    log('üí• Legend-based chart error: ' + error.message);
                    document.getElementById('chart-4').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
                }
            }, 3000);
        }

        // Test direct access
        window.testDirect = function() {
            log('üîß Direct test function called');
            console.log('Direct window.PaymentsCharts:', window.PaymentsCharts);
        };

        // Test window resize (for responsive behavior)
        window.testResize = function() {
            log('üì± Testing responsive behavior...');
            // Simulate mobile width
            document.body.style.width = '375px';
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
                log('üì± Resize event triggered (mobile simulation)');
            }, 100);
        };

        // Test hover interactions
        window.testHover = function() {
            log('üñ±Ô∏è Hover interactions should work automatically when charts are rendered');
            log('Try hovering over pie slices to see hover effects and tooltips');
        };
    </script>
</body>
</html>