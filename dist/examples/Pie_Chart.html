<div id="payments-chart-pie" style="width: 100%; height: 700px; margin: 20px 0;"></div>

<script>
(function() {
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      // Skip if script already loaded
      if (document.querySelector(`script[src="${src}"]`)) {
        resolve();
        return;
      }
      const s = document.createElement('script');
      s.src = src;
      s.onload = resolve;
      s.onerror = reject;
      document.head.appendChild(s);
    });
  }

  async function loadReactAndCharts() {
    try {
      // Load React if not present
      if (!window.React || !window.ReactDOM) {
        await loadScript('https://unpkg.com/react@18/umd/react.production.min.js');
        await loadScript('https://unpkg.com/react-dom@18/umd/react-dom.production.min.js');
      }

      // Load Pie Chart library
      await loadScript('https://nimble-starlight-bed049.netlify.app/pie-payments-charts.min.js');

      // Render the chart
      renderCharts();
    } catch (err) {
      console.error('Failed to load scripts:', err);
    }
  }

  function renderCharts() {
    // =====================
    // PIE CHART DATA EXAMPLES
    // =====================

    const paymentMethodsData = [
      { name: "Card payments", volume: 145000 },
      { name: "Bank transfers", volume: 89000 },
      { name: "Digital wallets", volume: 67000 },
      { name: "Direct debit", volume: 34000 },
      { name: "Cash", volume: 12000 },
      { name: "Cheques", volume: 3000 }
    ];

    const sectorValueData = [
      { name: "Retail", value: 2500000 },
      { name: "E-commerce", value: 1800000 },
      { name: "Financial services", value: 1200000 },
      { name: "Healthcare", value: 850000 },
      { name: "Government", value: 600000 }
    ];

    const regionalData = [
      { name: "London", volume: 450000 },
      { name: "South East", volume: 320000 },
      { name: "North West", volume: 280000 },
      { name: "Midlands", volume: 240000 },
      { name: "Scotland", volume: 180000 },
      { name: "Wales", volume: 120000 },
      { name: "North East", volume: 95000 },
      { name: "South West", volume: 185000 }
    ];

    const customerSegmentData = [
      { name: "Enterprise", revenue: 3200000 },
      { name: "SME", revenue: 1800000 },
      { name: "Startups", revenue: 950000 },
      { name: "Non-profit", revenue: 450000 }
    ];

    const transactionSizeData = [
      { name: "£0-10", count: 125000 },
      { name: "£10-50", count: 89000 },
      { name: "£50-100", count: 45000 },
      { name: "£100-500", count: 32000 },
      { name: "£500+", count: 18000 }
    ];

    // =====================
    // RENDER CHART
    // =====================
    const chartData = paymentMethodsData; // <-- Change to sectorValueData, regionalData, etc.

    if (window.PaymentsCharts && typeof window.PaymentsCharts.renderPieChart === 'function') {
      window.PaymentsCharts.renderPieChart('payments-chart-pie', {
        data: chartData,
        title: 'Payment Methods Distribution', // Update for each dataset as needed
        showLogo: true,
        width: '100%',
        height: 400,
        showInnerRadius: false, // true for donut chart
        showLabels: true,
        showLegend: true,
        sourceText: 'UK Finance payment statistics', 
        sourceUrl: 'https://www.ukfinance.org.uk/data-and-research/payment-statistics',
        notesDescription: `This pie chart visualises UK payment data.

Available datasets you can choose:
- paymentMethodsData: distribution of payment types (card, bank, cash, etc.)
- sectorValueData: transaction values by sector (Retail, E-commerce, etc.)
- regionalData: payment distribution by UK regions
- customerSegmentData: revenue by customer segment
- transactionSizeData: number of transactions by size

Switch datasets by updating the chartData variable. The chart supports labels, legend, and optional inner radius for donut charts.`
      });
    } else {
      console.error('PaymentsCharts.renderPieChart is not available yet.');
    }
  }

  loadReactAndCharts();
})();
</script>
